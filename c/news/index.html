<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Smolkat Press</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sofia+Sans+Extra+Condensed:wght@600&display=swap');
        
        body { font-family: sans-serif; margin: 0; line-height: 1.5em; }
        hr { border: none; border-top: 1px solid grey; margin: 1em 0; }
        
        h1 { font-family: "Sofia Sans Extra Condensed", serif; font-size: 3em; margin: 0.2em 0; line-height: 1em; }
        h3 { margin-top: 0; border-top: 4px solid #e32; padding-top: 0.5em; margin-bottom: 0.5em; }

        h1 a { color: black; text-decoration: none; }
        h1 a:hover { text-decoration: underline; }
        
        .meta { color: grey; border: 1px solid grey; border-left: none; border-right: none; margin: 0.6em 0; padding: 0.7em 0 0.5em; }
        .category { color: #e32; font-weight: 700; text-transform: uppercase; }

        /* maybe have the cat say the summary */
        .opinion { flex: 1; padding: 1em; background: #ddd; position: relative; }
        .opinion:before { content: ""; position: absolute; width: 0; height: 0; border: 4px solid #ddd; border-bottom-color: transparent; border-left-color: transparent; top: 0; left: -8px; }
    </style>

    <script type="module">

        function insertArticle(insert, news, full) {

            let authors;
            let summary;
            let category;
            
            if (news.authors == null) {
                authors = "Anonymous";
            } else {
                
                authors = news.authors[0];
                for (let i=1; i<news.authors.length; i++) {
                    authors += `, ${ news.authors[i] }`;
                }
            }

            summary = news.summary;

            if (summary.indexOf("\n") != -1) {
                summary = summary.substring(0, summary.indexOf("\n"));
            }

            category = news.category;

            if (category == undefined) {
                category = "Miscellaneous";
            }

            if (full) {
                insert.innerHTML += `
                    <div class="category">${ category }</div>
                    <h1>${ news.title }</h1>
                    <div>${ summary }</div>
                    <div class="meta">${ authors } | ${ news.publish_date }</div>
                    <img width="100%" src="${ news.image }">
                    <br>
                    <div>${ news.text.replaceAll("\n", "<br>") }</div>
                `;
            } else {
                insert.innerHTML += `
                    <hr>
                    <div class="category">${ category }</div>
                    <h1>
                        <a href="?id=${ news.id }">${ news.title }</a>
                    </h1>
                    <div>${ summary }</div>
                    <div class="meta">${ authors } | ${ news.publish_date }</div>
                    <img width="100%" src="${ news.image }">
                `;
            }
        }

        const apikey = "3b484cf0be92471090629e8156c0d3a1"; // don't steal my api key pls

        const id = new URLSearchParams(window.location.search).get('id');
        const insert = document.getElementById("insert");

        if (id == null) { // populate home

            fetch(`https://api.worldnewsapi.com/search-news?text=america&language=en&earliest-publish-date=2025-01-20&api-key=${ apikey }`)
            .then(res => {
                console.log(res);
                return res.json();
             })
            .then(json => {
    
                console.log(json);
                insert.innerHTML += "<h2>Search results for \"America\"</h2>";

                for (const article of json.news) {
                    insert(insertArticle, article, false);
                }
            });
            
        } else {
            
            fetch(`https://api.worldnewsapi.com/retrieve-news?ids=${ id }&api-key=${ apikey }`)
            .then(res => {
                console.log(res);
                return res.json();
             })
            .then(json => {

                console.log(json);
                insert(insertArticle, json.news[0], true);
            });
        }
        
    </script>
</head>
<body>
    
    <header style="background: #e32; color: white; padding: 0.5em; font-weight: 700; margin-top: 0;">
        <a href="?">Smolkat Press</a> - news and opinions - powered by <a href="https://worldnewsapi.com/">World News API</a>
    </header>
    
    <br>

    <main id="insert" style="max-width: 40em; margin: auto; padding: 0 1em;"></main>

    <br><br><br><br><br><br><br><br>

</body>
</html>

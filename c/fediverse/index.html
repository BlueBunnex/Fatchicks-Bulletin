<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Fediverse (Mastodon?) App</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap');
        body { width: 45em; margin: auto; font-family: "Outfit", sans-serif; }
    </style>
    <script type="module">

        // Tutorial: https://docs.joinmastodon.org/client/intro/

        // /api/v1/accounts/lookup?acct=johnnnnn

        // /api/v1/timelines/public
        // /api/v1/accounts/113480132212449271/statuses
        // /api/v1/timelines/tag/sillycat?limit=5

        const statusInsert = document.getElementById("status-insert");
        const loadStatusesPublicButton = document.getElementById("load-statuses-public-button");

        loadStatusesPublicButton.onclick = loadStatusesPublic;
        
        async function loadStatusesPublic() {

            loadStatusesPublicButton.disabled = true;
            
            const response = await fetch("https://mastodon.social/api/v1/timelines/tag/oppai?limit=40",
                {
                    method: "GET",
                    headers: {
                        "content-type": "application/json"
                    }
                }
            );
    
            if (response.status == 200) {
    
                const statuses = await response.json();
    
                console.log(statuses);
    
                for (const status of statuses) {
    
                    let imageEmbed = "";
    
                    for (const media of status.media_attachments) {
    
                        if (media.type === "image")
                            imageEmbed += `<img height="200" src="${ media.url }">`;
                    }
    
                    statusInsert.innerHTML += `
                        <div style="margin: 1em 0; padding: 1em; border: 1px solid black; border-radius: 8px;">
                            <strong><a href="${ status.account.url }">${ status.account.username }</a></strong>
                            <br>
                            ${ status.content }
                            <br>
                            ${ imageEmbed }
                        </div>
                    `;
                }
    
            } else {
    
                document.body.innerHTML += "Error " + response.status;
            }
        }

        loadStatusesPublic();
    </script>
</head>
<body>

    <div style="display: flex; gap: 4px;">
        <button style="flex: 1;" id="load-statuses-public-button">Public Feed</button>
        <input style="flex: 1;" type="text" placeholder="Search @users or #hashtags">
    </div>

    <div id="status-insert"></div>
    
</body>
</html>

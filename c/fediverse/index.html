<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Fediverse (Mastodon?) App</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap');
        body { width: 45em; margin: auto; font-family: "Outfit", sans-serif; }
    </style>
    <script type="module">

        // Tutorial: https://docs.joinmastodon.org/client/intro/

        // /api/v1/accounts/lookup?acct=johnnnnn

        // /api/v1/timelines/public
        // /api/v1/accounts/113480132212449271/statuses
        // /api/v1/timelines/tag/sillycat?limit=5

        const contentInsert            = document.getElementById("content-insert");
        
        const buttonLoadStatusesPublic = document.getElementById("button-load-statuses-public");
        const inputLoadFromSearch      = document.getElementById("input-load-from-search");
        
        loadStatusesPublicButton.onclick = loadStatusesPublic;
        inputLoadFromSearch.onchange     = loadFromSearch;

        function insertStatuses(statuses) {

            for (const status of statuses) {
    
                let imageEmbed = "";

                for (const media of status.media_attachments) {

                    if (media.type === "image")
                        imageEmbed += `<img height="200" src="${ media.url }">`;
                }

                contentInsert.innerHTML += `
                    <div style="margin: 1em 0; padding: 1em; border: 1px solid black; border-radius: 8px;">
                        <strong><a href="${ status.account.url }">${ status.account.username }</a></strong>
                        <br>
                        ${ status.content }
                        <br>
                        ${ imageEmbed }
                    </div>
                `;
            }
        }

        async function loadFromSearch() {

        }
        
        async function loadStatusesPublic() {

            buttonLoadStatusesPublic.disabled = true;
            
            const response = await fetch("https://mastodon.social/api/v1/timelines/public",
                {
                    method: "GET",
                    headers: {
                        "content-type": "application/json"
                    }
                }
            );
    
            if (response.status == 200) {
    
                const statuses = await response.json();
    
                console.log(statuses);
    
                insertStatuses(statuses);
    
            } else {
                alert("Error " + response.status);
            }
        }

        loadStatusesPublic();
    </script>
</head>
<body>

    <div style="display: flex; gap: 4px;">
        <button style="flex: 1;" id="button-load-statuses-public">Public Feed</button>
        <input style="flex: 1;" id="input-load-from-search" type="text" placeholder="Search @users or #hashtags">
    </div>

    <div id="content-insert"></div>
    
</body>
</html>

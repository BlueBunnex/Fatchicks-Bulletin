<!DOCTYPE html>
<html>
<head>
    <title>fatchicks.cc</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;700&display=swap');
        
        :root { font-size: 18px; }
        body { font-family: 'EB Garamond', serif; color: #444; }
        a { color: #08e; }
        .center { width: 35rem; margin: auto; }
        #image { height: 25em; display: block; margin: auto; }
        h1, h2 { margin: 0; }
    </style>

    <!-- this code is trash, but it's self contained trash (except for file formatting, hmm) -->
    <script type="module">
        function crop(data, startToken, endToken) { // if endToken doesn't exist, just goes to end
            var subData;
            
            const start = data.indexOf(startToken);
            if (start == -1)
                return "";
            subData = data.substring(start + startToken.length);

            const end = subData.indexOf(endToken);
            if (end != -1)
                subData = subData.substring(0, end);

            return subData;
        }
        
        const storyTitle = new URLSearchParams(window.location.search).get('title');
        const storyIndex = parseInt(new URLSearchParams(window.location.search).get('index'));

        const listofIndex = document.getElementById('listof-index'),
              title       = document.getElementById('title'),
              author      = document.getElementById('author'),
              paragraphs  = document.getElementById('paragraphs'),
              next        = document.getElementById('next'),
              image       = document.getElementById('image');

        if (storyTitle != null) {
            
            fetch("/stories/" + storyTitle)
            .then(file => file.text())
            .then(data => {

                // parse title and author
                title.innerHTML = crop(data, "[title]{", "}");
                author.innerHTML = crop(data, "[author]{", "}");

                // parse all indices
                var largestIndex = 1;
                for (let i=1; data.indexOf("#" + i) != -1; i++) {

                    if (i == storyIndex) {
                        listofIndex.innerHTML += ` [<a href="?title=${storyTitle}&index=${i}">${i}</a>]`;
                    } else {
                        listofIndex.innerHTML += ` <a href="?title=${storyTitle}&index=${i}">${i}</a>`;
                    }
                    largestIndex = i;
                }

                // parse image and paragraphs
                var subData = crop(data, "#" + storyIndex, "#" + (storyIndex + 1));

                if (subData != "") {
                    image.src = crop(subData, "[image]{", "}");
                    paragraphs.innerHTML = crop(subData, "[paragraphs]{", "}");

                    if (storyIndex == largestIndex) {
                        next.innerHTML = "<u>End of all parts</u>";
                    } else {
                        next.innerHTML = `<a href="?title=${ storyTitle }&index=${ storyIndex + 1 }">Go to part ${ storyIndex + 1}</a>`;
                    }
                }
                
            });
            
        } else {
            // 404
        }
    </script>
</head>
<body>

    <div class="center" style="display: flex; align-items: center; gap: 1em;">
        <h1>Fatchicks.cc</h1>
        <a href="/">Home</a>
    </div>
    
    <img id="image">
    <div style="text-align: center; font-size: small;"><a href="https://www.deviantart.com/olgrizzle/art/Hot-Buffet-Girl-Gets-Fat-4-966910527">Image Source</a></div>
    
    <div class="center" style="margin-bottom: 8em;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1em; border-bottom: 1px solid lightgrey; padding-bottom: 4px;">
            <h2 id="title"></h2>
            <div id="listof-index"></div>
        </div>
        <div>Author: <span id="author"></span></div>

        <div id="paragraphs"></div>

        <div id="next" style="text-align: center;"></div>
    </div>
    
</body>
</html>

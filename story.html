<!DOCTYPE html>
<html>
<head>
    <title>fatchicks.cc</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;700&display=swap');
        
        :root { font-size: 18px; }
        body { font-family: 'EB Garamond', serif; color: #444; }
        a { color: #08e; }
        .center { width: 35rem; margin: auto; }
        #image { height: 25em; display: block; margin: auto; }
    </style>

    <script type="module">
        const storyTitle = new URLSearchParams(window.location.search).get('title');
        const storyIndex = parseInt(new URLSearchParams(window.location.search).get('index'));

        const listofIndex = document.getElementById('listof-index'),
              title       = document.getElementById('title'),
              paragraphs  = document.getElementById('paragraphs'),
              next        = document.getElementById('next'),
              image       = document.getElementById('image');

        if (storyTitle != null) {
            
            fetch("/stories/" + storyTitle)
            .then(file => file.text())
            .then(data => {

                // parse title
                title.innerHTML = data.substring(0, data.indexOf("\n"));

                // parse all indices
                for (let i=1; data.indexOf("#" + i) != -1; i++) {

                    if (i == storyIndex) {
                        listofIndex.innerHTML += `[<a href="?title=${storyTitle}&index=${i}">${i}</a>]`;
                    } else {
                        listofIndex.innerHTML += `<a href="?title=${storyTitle}&index=${i}">${i}</a>`;
                    }
                }

                // parse image and paragraphs
                const startOfIndex = data.indexOf("#" + storyIndex) + 2;
                const endOfIndex   = data.indexOf("#" + (storyIndex + 1));

                var subData;

                if (startOfIndex == -1) {
                    // 404
                    return;
                } else if (endOfIndex == -1) {
                    subData = data.substring(startOfIndex);
                    next.innerHTML = "<u>End of all parts</u>";
                } else {
                    subData = data.substring(startOfIndex, endOfIndex);
                    next.innerHTML = `<a href="?title=${ storyTitle }&index=${ storyIndex + 1 }">Go to part ${ storyIndex + 1}</a>`;
                }

                paragraphs.innerHTML = subData;

                //image.src = '';
                
            });
            
        } else {
            // 404
        }
    </script>
</head>
<body>

    <div class="center">
        <h1>Fatchicks.cc</h1>
        <a href="/">Home</a>
    </div>
    
    <img id="image">
    <div style="text-align: center; font-size: small;"><a href="https://www.deviantart.com/olgrizzle/art/Hot-Buffet-Girl-Gets-Fat-4-966910527">Image Source</a></div>
    
    <div class="center">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1em; border-bottom: 1px solid lightgrey; padding-bottom: 4px;">
            <h2 id="title" style="margin: 0;"></h2>

            <div id="listof-index"></div>
        </div>

        <div id="paragraphs">
            
        </div>

        <div id="next" style="text-align: center;"></div>
    </div>
    
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <title>fatchicks.cc</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body { margin: 0; background: #eff; font-family: Calibri, sans-serif; }
        h1 { color: #c00; font-size: 2.5em; }
        a { color: #c00; }

        .post { margin: 8px; border: 2px solid #acc; padding: 8px; overflow-y: hidden; }
        .post-file { float: left; text-align: center; padding-right: 8px; padding-bottom: 8px; }
        .post-file > img { height: 200px; display: block; }
        .post-foot { clear: both; }

        /* and then .comment but that's later */
    </style>

    <!--
    tutorial for IBM Cloud
    Setting up Database and Container  https://cloud.ibm.com/docs/solution-tutorials?topic=solution-tutorials-serverless-webapp
    Changing Container code            https://cloud.ibm.com/docs/codeengine?topic=codeengine-build-create-config1
    -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script type="module">

        const apiUrl = 'https://fatchicks-backend-container.1ivbwhyon9ev.us-east.codeengine.appdomain.cloud';
        const posts = {
            // retrieve the existing posts
            get() {
                return $.ajax({
                    type: 'GET',
                    url: `${apiUrl}/posts/entries`,
                    dataType: 'json'
                });
            },
            
            // add a single post with parameters
            add(message) {
                return $.ajax({
                    type: 'POST',
                    url: `${apiUrl}/posts/entries`,
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify({message}),
                    dataType: 'json'
                });
            }
        };

        function timeConverter(ms) { // I stole this code
            var a = new Date(ms);
            var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
            var year = a.getFullYear();
            var month = months[a.getMonth()];
            var date = a.getDate();
            var hour = a.getHours();
            var min = a.getMinutes();
            var sec = a.getSeconds();
            var time = date + ' ' + month + ' ' + year + ' ' + hour + ':' + min + ':' + sec;
            return time;
        }

        function loadPosts() {
            
            const postbox = document.getElementById('postbox');
            postbox.innerHTML = "Loading posts...";
            
            posts.get().done(function(result) {
                if (!result.entries) {
                    postbox.innerHTML = "Something went wrong on our end.";
                    return;
                }
    
                postbox.innerHTML = "";
    
                // sort by unixTimestamp
                result.entries.sort((a, b) => a.unixTimestamp < b.unixTimestamp);
    
                // display all posts
                for (const [index, post] of Object.entries(result.entries)) {

                    // <div class="post">
                    //     <div class="post-file">
                    //         <img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/88b4d8de-fa9b-4c4d-8346-62f1019dd0a1/degrcu9-df02f246-a6f4-4f86-b308-623ff559d9b3.jpg/v1/fill/w_923,h_866,q_70,strp/fat_girl_tight_clothes_by_wilhelm12345_degrcu9-pre.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9MTA1NSIsInBhdGgiOiJcL2ZcLzg4YjRkOGRlLWZhOWItNGM0ZC04MzQ2LTYyZjEwMTlkZDBhMVwvZGVncmN1OS1kZjAyZjI0Ni1hNmY0LTRmODYtYjMwOC02MjNmZjU1OWQ5YjMuanBnIiwid2lkdGgiOiI8PTExMjUifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6aW1hZ2Uub3BlcmF0aW9ucyJdfQ.paWy76wU3nSV791JgVYMSZHiUjKWgrI6gZKFJqLVSBQ">
                    //         36KB PNG
                    //     </div>
                    //     <div class="post-body">
                    //         what's up robots here's more meat for y'all you're welcome
                    //     </div>
                    //     <div class="post-foot">
                    //         <a href="">View all comments</a> | Mar 3 2014 01:23:45
                    //     </div>
                    // </div>
    
                    postbox.innerHTML += `
                        <div class="post">
                            <div class="post-file">
                                <img src="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/88b4d8de-fa9b-4c4d-8346-62f1019dd0a1/degrcu9-df02f246-a6f4-4f86-b308-623ff559d9b3.jpg/v1/fill/w_923,h_866,q_70,strp/fat_girl_tight_clothes_by_wilhelm12345_degrcu9-pre.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9MTA1NSIsInBhdGgiOiJcL2ZcLzg4YjRkOGRlLWZhOWItNGM0ZC04MzQ2LTYyZjEwMTlkZDBhMVwvZGVncmN1OS1kZjAyZjI0Ni1hNmY0LTRmODYtYjMwOC02MjNmZjU1OWQ5YjMuanBnIiwid2lkdGgiOiI8PTExMjUifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6aW1hZ2Uub3BlcmF0aW9ucyJdfQ.paWy76wU3nSV791JgVYMSZHiUjKWgrI6gZKFJqLVSBQ">
                                PLACEHOLDER PNG
                            </div>
                            <div class="post-body">${post.message}</div>
                            <div class="post-foot">${timeConverter(post.unixTimestamp)}</div>
                        </div>
                    `;
                    
                }
    
            }).error(function(error) {
                postbox.innerHTML = error;
            });
        }
        
        // intercept the click on the submit button, add the post entry and reload entries on success
        $(document).on('submit', '#addEntry', function(e) {
            e.preventDefault();
            
            posts.add(
                document.getElementById('message').value.trim()
            ).done(function(result) {
                // reload posts
                loadPosts();
            }).error(function(error) {
                console.log(error);
            });
        });

        loadPosts();
    </script>
</head>
<body>

    <center>
        <h1>fatchicks.cc - BBW Image Board</h1>
        <p>An Internet bulletin board dedicated to Big Beautiful Women. This site is WIP. You can find the Github repo <a href="https://github.com/BlueBunnex/myblog">here</a>.</p>

        <fieldset style="display: inline-block; text-align: left;">
            <legend>Make Post</legend>

            <form id="addEntry">
                <br>
                <label for="image">Select an image file:</label>
                <input type="file" id="image"><br><br>
                
                <label for="message">Message:</label><br>
                <textarea id="message" rows="4" cols="50" style="max-width: 100ch; max-height: 12ch;"></textarea>

                <ul>
                    <li>Empty posts and HTML tags are automatically discarded.</li>
                </ul>
                <input type="submit" value="Post">
            </form>
        </fieldset>
    </center>

    <div style="padding: 4px 8px; border-top: 2px solid #acc; margin: 1em 0;">
        showing all posts
        <!--         showing 20 of 96
        <a href="">1</a>
        <a href="">2</a>
        <a href="">3</a>
        <a href="">4</a>
        <a href="">5</a> -->
    </div>

    <div id="postbox"></div>
    
</body>
</html>
